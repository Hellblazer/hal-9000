# ~/.tmux.conf
# hal-9000 recommended tmux configuration
# Includes GPU/CPU monitoring, Catppuccin theme, and productivity enhancements

# ═══════════════════════════════════════════════════════════════════
# Core Settings
# ═══════════════════════════════════════════════════════════════════

# Enable true 24-bit color support
set -g default-terminal "xterm-256color"
set-option -ga terminal-overrides ",xterm-256color:Tc"

# Prefix key (default: Ctrl+b)
# Uncomment to use Ctrl+a instead:
# unbind C-b
# set-option -g prefix C-a
# bind-key C-a send-prefix

# Mouse support for easy pane selection
set -g mouse on

# Increase history for verbose outputs
set -g history-limit 50000

# UTF-8 support
setw -q -g utf8 on

# Start window/pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# ═══════════════════════════════════════════════════════════════════
# Mouse & Clipboard Integration (macOS)
# ═══════════════════════════════════════════════════════════════════

# Mouse copy to system clipboard
bind-key -T copy-mode MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# Scroll in normal mode enters copy mode
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t =; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t = \; send-keys -M

# Quick toggle for mouse mode (prefix + m)
bind m set -g mouse \; display "Mouse: #{?mouse,ON,OFF}"

# ═══════════════════════════════════════════════════════════════════
# Catppuccin Mocha Theme
# ═══════════════════════════════════════════════════════════════════

set -g status-style "bg=#1e1e2e,fg=#cdd6f4"
set -g window-status-current-style "bg=#89b4fa,fg=#1e1e2e,bold"
set -g pane-border-style "fg=#313244"
set -g pane-active-border-style "fg=#89b4fa"
set -g message-style "bg=#313244,fg=#cdd6f4"

# ═══════════════════════════════════════════════════════════════════
# Tmux Plugin Manager (TPM)
# ═══════════════════════════════════════════════════════════════════

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-cpu'  # CPU/RAM monitoring (works on macOS)

# CPU/RAM plugin settings
set -g @cpu_low_icon "="
set -g @cpu_medium_icon "≡"
set -g @cpu_high_icon "≣"

set -g @cpu_low_fg_color "#[fg=#a6e3a1]"      # Green
set -g @cpu_medium_fg_color "#[fg=#f9e2af]"   # Yellow
set -g @cpu_high_fg_color "#[fg=#f38ba8]"     # Red

set -g @cpu_low_bg_color "#[bg=#1e1e2e]"
set -g @cpu_medium_bg_color "#[bg=#1e1e2e]"
set -g @cpu_high_bg_color "#[bg=#1e1e2e]"

# Note: GPU monitoring requires cuda-smi (NVIDIA only, deprecated on macOS)
# Apple Silicon GPU metrics are not accessible via tmux-cpu

# Resurrect settings
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'on'

# ═══════════════════════════════════════════════════════════════════
# Status Bar with CPU/GPU Monitoring
# ═══════════════════════════════════════════════════════════════════

# Update interval
set -g status-interval 2

# Status bar position
set -g status-position bottom

# Left status: Session name
set -g status-left "#[bg=#89b4fa,fg=#1e1e2e,bold] #S #[bg=#1e1e2e,fg=#89b4fa]"
set -g status-left-length 50

# Right status: System info + User + Host
set -g status-right "#{cpu_bg_color}#{cpu_fg_color} CPU:#{cpu_percentage} #{ram_percentage} #[fg=#89b4fa]│ #[fg=#f5c2e7]#(whoami) #[bg=#89b4fa,fg=#1e1e2e,bold] #h "
set -g status-right-length 150

# Window status format
set -g window-status-format "#[fg=#6c7086] #I:#W "
set -g window-status-current-format "#[bg=#89b4fa,fg=#1e1e2e,bold] #I:#W "

# ═══════════════════════════════════════════════════════════════════
# Key Bindings
# ═══════════════════════════════════════════════════════════════════

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Split panes with | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# ═══════════════════════════════════════════════════════════════════
# Initialize TPM (keep this at the very bottom)
# ═══════════════════════════════════════════════════════════════════

# Install TPM if not already installed
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager
run '~/.tmux/plugins/tpm/tpm'
