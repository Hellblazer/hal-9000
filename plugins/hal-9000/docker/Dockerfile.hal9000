# HAL-9000 Optimized ClaudeBox Image
# Pre-installs all tools for instant container startup
#
# Build: docker build -f docker/Dockerfile.hal9000 -t ghcr.io/hellblazer/hal-9000:latest .
# Publish: docker push ghcr.io/hellblazer/hal-9000:latest
# Use with aod: aod.sh automatically uses this image

FROM debian:bookworm-slim

LABEL maintainer="hal-9000"
LABEL description="Optimized ClaudeBox image with pre-installed claude-code-tools"
LABEL version="1.1.0"

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    git \
    tmux \
    python3 \
    python3-pip \
    python3-venv \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Install uv (fast Python package installer)
RUN curl -LsSf https://astral.sh/uv/install.sh | sh

# Add uv to PATH
ENV PATH="/root/.local/bin:${PATH}"

# Pre-install claude-code-tools (this is the optimization!)
# This layer is cached - subsequent builds/containers reuse it
RUN uv tool install claude-code-tools

# Install common development tools based on profile
# These can be extended for specific language profiles

# Create workspace directory
RUN mkdir -p /workspace
WORKDIR /workspace

# Verify installation
RUN tmux-cli --help > /dev/null 2>&1 && echo "✓ claude-code-tools installed" || echo "✗ Installation failed"

# Default command
CMD ["/bin/bash"]
