# HAL-9000 Log Rotation Configuration
#
# This configuration manages log rotation for HAL-9000 security and audit logs.
# Install by copying to /etc/logrotate.d/hal9000 or running logrotate manually:
#   logrotate -f /path/to/logrotate.conf
#
# Log files managed:
#   - security.log: Security-relevant events (hook denials, auth failures, etc.)
#   - audit.log: General operational audit log (worker spawn/stop, etc.)
#   - chromadb.log: ChromaDB server logs
#
# IMPORTANT: This configuration is optimized for forensic retention.
# Security logs are kept for 90 days for incident investigation.

# Security log - most critical, longest retention
/root/.hal9000/logs/security.log {
    # Rotate daily
    daily

    # Keep 90 days of logs for incident investigation
    rotate 90

    # Compress old logs to save space
    compress
    delaycompress

    # Don't error if log is missing
    missingok

    # Don't rotate empty logs
    notifempty

    # Create new log with secure permissions
    create 0640 root root

    # Use date extension for easier forensics
    dateext
    dateformat -%Y%m%d

    # Size-based rotation: rotate if > 50MB even if not daily
    maxsize 50M

    # Run script after rotation
    postrotate
        # Notify monitoring system if available
        if [ -x /scripts/notify-log-rotation.sh ]; then
            /scripts/notify-log-rotation.sh security
        fi
    endscript
}

# Audit log - operational events
/root/.hal9000/logs/audit.log {
    # Rotate daily
    daily

    # Keep 30 days
    rotate 30

    # Compress old logs
    compress
    delaycompress

    # Don't error if log is missing
    missingok

    # Don't rotate empty logs
    notifempty

    # Create new log with secure permissions
    create 0640 root root

    # Use date extension
    dateext
    dateformat -%Y%m%d

    # Size-based rotation
    maxsize 50M
}

# ChromaDB server log
/root/.hal9000/logs/chromadb.log {
    # Rotate daily
    daily

    # Keep 14 days
    rotate 14

    # Compress old logs
    compress
    delaycompress

    # Don't error if log is missing
    missingok

    # Don't rotate empty logs
    notifempty

    # Create new log
    create 0644 root root

    # Use date extension
    dateext
    dateformat -%Y%m%d

    # Size-based rotation
    maxsize 100M
}

# Image pull log (low priority)
/root/.hal9000/logs/image-pull.log {
    # Rotate weekly
    weekly

    # Keep 4 weeks
    rotate 4

    # Compress
    compress

    # Standard options
    missingok
    notifempty
    create 0644 root root
}

# Pool manager log
/root/.hal9000/logs/pool-manager.log {
    daily
    rotate 7
    compress
    missingok
    notifempty
    create 0644 root root
    maxsize 10M
}
